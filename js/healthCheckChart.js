$(function(){function d(o,g,n){var f=0;var h=n.length;var m=0;var p=0;while(h){h-=1;var k=g[n[h]];if(f<o){m+=k.len;p+=k.success}f+=1}var l=Math.floor((p*100)/m);if(l<25){var e="red"}else{if(l>75){var e="green"}else{var e="orange"}}return'<font color="'+e+'">'+l+"</font>"}$(document).ready($.getJSON("/api/data/apis.json",function(e){$("#graphMenuList").attr("enabled","true");var f=false;$.each(e,function(g,h){if(f==false){$("#graphTitle").text(h.apiName);c(h.dataUrl,h.endpointUrl,h.apiName);f=true}$("#graphMenuList").append($("<option></option>").text(h.apiName).val(h.rawName))})}));$("#graphMenuList").change(function(){$("#endpointMenuList").find("option").remove().end().append("<option>All</option>");var e=$(this).find(":selected").val();$.getJSON("/api/data/apis.json",function(f){$("#endpointMenuList").attr("enabled","true");$.each(f,function(g,h){if(h.rawName==e){$("#graphTitle").text(h.apiName);c(h.dataUrl,h.endpointUrl,h.apiName);$.each(h.endpointUrl,function(){$("#endpointMenuList").append($("<option></option>").text(this).val(this))})}})})});$("#endpointMenuList").change(function(){var e=$("#graphMenuList").find(":selected").val();var f=$(this).find(":selected").val();$.getJSON("/api/data/apis.json",function(g){$("#endpointMenuList").attr("enabled","true");$.each(g,function(h,i){if(i.rawName==e){$("#graphTitle").text(i.apiName);if(f=="All"){var j=c(i.dataUrl,i.endpointUrl,i.apiName)}else{var j=c(i.dataUrl,[f],i.apiName)}}})})});function b(j){var e=/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+).(\d*)/;var g=j.match(e);var l=[],k,f;if(g){for(var h=1;h<g.length;h++){l.push(parseInt(g[h],10))}return(new Date(l[0],l[1],l[2],l[3],l[4],l[5]))}}function c(g,e,f){$.getJSON(g,function(m){var h=[];var q=[];$.each(m,function(v,w){if($.inArray(w.endpointUrl,e)!==-1){var j=b(w.createdAt);var i=j.getMonth()+"-"+j.getDate()+"-"+j.getFullYear();if((i in h)==false){q.push(i);h[i]={values:[],len:0,success:0}}if(("error" in w)==false){h[i].values.push(w.responseTime);h[i].success+=1}h[i].len+=1}});$("#successRate").html("Daily uptime rate: <strong>"+d(1,h,q)+"%</strong>  -  Weekly uptime rate: <strong>"+d(7,h,q)+"%</strong>");var l=[];var k=[];var t=[];var s=[];var p=0;while(p<q.length){var o=h[q[p]];var u=o.values.sort(function(j,i){return j-i}).slice(2,-2);l.push(Math.floor(u[u.length-1]));s.push(Math.floor(u[0]));k.push(Math.floor(u[Math.floor(u.length/2)]));var r=0;var n=0;while(n<u.length){r+=u[n];n++}t.push(Math.floor(r/u.length));p+=1}a(q,s,t,k,l)})}function a(h,i,j,e,f){$("#healthCheck").remove();$("#healthCheckDiv").append('<canvas id="healthCheck"><canvas>');var l=$("#healthCheck").get(0).getContext("2d");var g={labels:h,datasets:[{label:"Max",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:f},{label:"Median",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:e},{label:"Min",fillColor:"rgba(180,200,100,0.2)",strokeColor:"rgba(180,200,100,1)",pointColor:"rgba(180,200,100,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(180,200,100,1)",data:i}]};var m={scaleShowGridLines:true,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:true,scaleShowVerticalLines:true,bezierCurve:true,bezierCurveTension:0.4,pointDot:true,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:true,datasetStrokeWidth:2,datasetFill:true,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',responsive:true,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",multiTooltipTemplate:"<%=datasetLabel%>: <%= value %>"};var k=new Chart(l).Line(g,m)}});